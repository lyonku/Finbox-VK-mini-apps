{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _objectSpread from \"@babel/runtime/helpers/objectSpread2\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"onStart\", \"onStartX\", \"onStartY\", \"onMove\", \"onMoveX\", \"onMoveY\", \"onLeave\", \"onEnter\", \"onEnd\", \"onEndX\", \"onEndY\", \"onClickCapture\", \"usePointerHover\", \"slideThreshold\", \"useCapture\", \"Component\", \"getRootRef\", \"noSlideClick\", \"stopPropagation\"];\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\nimport * as React from \"react\";\nimport { getSupportedEvents, coordX, coordY, touchEnabled } from \"../../lib/touch\";\nimport { useDOM } from \"../../lib/dom\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { useEventListener } from \"../../hooks/useEventListener\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nexport var Touch = function Touch(_ref) {\n  var onStart = _ref.onStart,\n    onStartX = _ref.onStartX,\n    onStartY = _ref.onStartY,\n    _onMove = _ref.onMove,\n    onMoveX = _ref.onMoveX,\n    onMoveY = _ref.onMoveY,\n    onLeave = _ref.onLeave,\n    onEnter = _ref.onEnter,\n    _onEnd = _ref.onEnd,\n    onEndX = _ref.onEndX,\n    onEndY = _ref.onEndY,\n    onClickCapture = _ref.onClickCapture,\n    usePointerHover = _ref.usePointerHover,\n    _ref$slideThreshold = _ref.slideThreshold,\n    slideThreshold = _ref$slideThreshold === void 0 ? 5 : _ref$slideThreshold,\n    _ref$useCapture = _ref.useCapture,\n    useCapture = _ref$useCapture === void 0 ? false : _ref$useCapture,\n    _ref$Component = _ref.Component,\n    Component = _ref$Component === void 0 ? \"div\" : _ref$Component,\n    getRootRef = _ref.getRootRef,\n    _ref$noSlideClick = _ref.noSlideClick,\n    noSlideClick = _ref$noSlideClick === void 0 ? false : _ref$noSlideClick,\n    _ref$stopPropagation = _ref.stopPropagation,\n    stopPropagation = _ref$stopPropagation === void 0 ? false : _ref$stopPropagation,\n    restProps = _objectWithoutProperties(_ref, _excluded);\n  var _useDOM = useDOM(),\n    document = _useDOM.document;\n  var events = React.useMemo(getSupportedEvents, []);\n  var didSlide = React.useRef(false);\n  var gesture = React.useRef(null);\n  var handle = function handle(e, handers) {\n    stopPropagation && e.stopPropagation();\n    handers.forEach(function (cb) {\n      var _gesture$current$star, _gesture$current, _gesture$current$star2;\n      var duration = Date.now() - ((_gesture$current$star = (_gesture$current = gesture.current) === null || _gesture$current === void 0 ? void 0 : (_gesture$current$star2 = _gesture$current.startT) === null || _gesture$current$star2 === void 0 ? void 0 : _gesture$current$star2.getTime()) !== null && _gesture$current$star !== void 0 ? _gesture$current$star : 0);\n      cb && cb(_objectSpread(_objectSpread({}, gesture.current), {}, {\n        duration: duration,\n        originalEvent: e\n      }));\n    });\n  };\n  var enterHandler = useEventListener(usePointerHover ? \"pointerenter\" : \"mouseenter\", onEnter);\n  var leaveHandler = useEventListener(usePointerHover ? \"pointerleave\" : \"mouseleave\", onLeave);\n  var startHandler = useEventListener(events[0], function (e) {\n    gesture.current = initGesture(coordX(e), coordY(e));\n    handle(e, [onStart, onStartX, onStartY]); // 1 line, 2 bad specs, 2 workarounds:\n\n    subscribe(touchEnabled() ?\n    // Touch events fire on initial target, and won't bubble if its removed\n    // see: #235, #1968, https://stackoverflow.com/a/45760014\n    e.target :\n    // Mouse events fire on the element under pointer, so we lose move / end\n    // if pointer goes outside container.\n    // Can be fixed by PointerEvents' setPointerCapture later\n    document);\n  }, {\n    capture: useCapture,\n    passive: false\n  });\n  var containerRef = useExternRef(getRootRef);\n  useIsomorphicLayoutEffect(function () {\n    var el = containerRef.current;\n    if (el) {\n      enterHandler.add(el);\n      leaveHandler.add(el);\n      startHandler.add(el);\n    }\n  }, [Component]);\n  function onMove(e) {\n    var _gesture$current2;\n    var _ref2 = (_gesture$current2 = gesture.current) !== null && _gesture$current2 !== void 0 ? _gesture$current2 : {},\n      isPressed = _ref2.isPressed,\n      isX = _ref2.isX,\n      isY = _ref2.isY,\n      _ref2$startX = _ref2.startX,\n      startX = _ref2$startX === void 0 ? 0 : _ref2$startX,\n      _ref2$startY = _ref2.startY,\n      startY = _ref2$startY === void 0 ? 0 : _ref2$startY;\n    if (isPressed) {\n      var _gesture$current3;\n\n      // смещения\n      var shiftX = coordX(e) - startX;\n      var shiftY = coordY(e) - startY; // абсолютные значения смещений\n\n      var shiftXAbs = Math.abs(shiftX);\n      var shiftYAbs = Math.abs(shiftY); // Если определяем мультитач, то прерываем жест\n\n      if (!!e.touches && e.touches.length > 1) {\n        return onEnd(e);\n      } // если мы ещё не определились\n\n      if (!isX && !isY) {\n        var willBeX = shiftXAbs >= slideThreshold && shiftXAbs > shiftYAbs;\n        var willBeY = shiftYAbs >= slideThreshold && shiftYAbs > shiftXAbs;\n        var willBeSlidedX = willBeX && (!!onMoveX || !!_onMove);\n        var willBeSlidedY = willBeY && (!!onMoveY || !!_onMove);\n        Object.assign(gesture.current, {\n          isY: willBeY,\n          isX: willBeX,\n          isSlideX: willBeSlidedX,\n          isSlideY: willBeSlidedY,\n          isSlide: willBeSlidedX || willBeSlidedY\n        });\n      }\n      if ((_gesture$current3 = gesture.current) !== null && _gesture$current3 !== void 0 && _gesture$current3.isSlide) {\n        Object.assign(gesture.current, {\n          shiftX: shiftX,\n          shiftY: shiftY,\n          shiftXAbs: shiftXAbs,\n          shiftYAbs: shiftYAbs\n        });\n        handle(e, [_onMove, gesture.current.isSlideX && onMoveX, gesture.current.isSlideY && onMoveY]);\n      }\n    }\n  }\n  function onEnd(e) {\n    var _gesture$current4;\n    var _ref3 = (_gesture$current4 = gesture.current) !== null && _gesture$current4 !== void 0 ? _gesture$current4 : {},\n      isPressed = _ref3.isPressed,\n      isSlide = _ref3.isSlide,\n      isSlideX = _ref3.isSlideX,\n      isSlideY = _ref3.isSlideY;\n    if (isPressed) {\n      handle(e, [_onEnd, isSlideY && onEndY, isSlideX && onEndX]);\n    }\n    didSlide.current = Boolean(isSlide);\n    gesture.current = {}; // Если это был тач-евент, симулируем отмену hover\n\n    if (touchEnabled()) {\n      onLeave && onLeave(e);\n    }\n    subscribe(null);\n  }\n  var listenerParams = {\n    capture: useCapture,\n    passive: false\n  };\n  var listeners = [useEventListener(events[1], onMove, listenerParams), useEventListener(events[2], onEnd, listenerParams), useEventListener(events[3], onEnd, listenerParams)];\n  function subscribe(el) {\n    if (el) {\n      listeners.forEach(function (l) {\n        return l.add(el);\n      });\n    }\n  }\n  /**\n   * Обработчик событий dragstart\n   * Отменяет нативное браузерное поведение для вложенных ссылок и изображений\n   */\n\n  var onDragStart = function onDragStart(e) {\n    var target = e.target;\n    if (target.tagName === \"A\" || target.tagName === \"IMG\") {\n      e.preventDefault();\n    }\n  };\n  /**\n   * Обработчик клика по компоненту\n   * Отменяет переход по вложенной ссылке, если был зафиксирован свайп\n   */\n\n  var postGestureClick = function postGestureClick(e) {\n    if (!didSlide.current) {\n      return onClickCapture && onClickCapture(e);\n    } // eslint-disable-next-line no-restricted-properties\n\n    if (e.target.closest(\"a\")) {\n      e.preventDefault();\n    }\n    if (noSlideClick) {\n      e.stopPropagation();\n    } else {\n      onClickCapture && onClickCapture(e);\n    }\n    didSlide.current = false;\n  };\n  return createScopedElement(Component, _extends({}, restProps, {\n    onDragStart: onDragStart,\n    onClickCapture: postGestureClick,\n    ref: containerRef\n  }));\n};\nfunction initGesture(startX, startY) {\n  return {\n    startX: startX,\n    startY: startY,\n    startT: new Date(),\n    duration: 0,\n    isPressed: true,\n    isY: false,\n    isX: false,\n    isSlideX: false,\n    isSlideY: false,\n    isSlide: false,\n    shiftX: 0,\n    shiftY: 0,\n    shiftXAbs: 0,\n    shiftYAbs: 0\n  };\n}","map":{"version":3,"mappings":"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","names":["React","getSupportedEvents","coordX","coordY","touchEnabled","useDOM","useExternRef","useEventListener","useIsomorphicLayoutEffect","Touch","onStart","onStartX","onStartY","_onMove","onMove","onMoveX","onMoveY","onLeave","onEnter","_onEnd","onEnd","onEndX","onEndY","onClickCapture","usePointerHover","_ref$slideThreshold","slideThreshold","_ref$useCapture","useCapture","_ref$Component","Component","getRootRef","_ref$noSlideClick","noSlideClick","_ref$stopPropagation","stopPropagation","restProps","document","events","useMemo","didSlide","useRef","gesture","handle","e","handers","forEach","cb","duration","Date","now","current","_gesture$current","startT","_gesture$current$star2","getTime","originalEvent","enterHandler","leaveHandler","startHandler","initGesture","subscribe","target","capture","passive","containerRef","el","add","isPressed","isX","isY","_ref2$startX","startX","_ref2$startY","startY","shiftX","shiftY","shiftXAbs","Math","abs","shiftYAbs","touches","length","willBeX","willBeY","willBeSlidedX","willBeSlidedY","Object","assign","isSlideX","isSlideY","isSlide","_gesture$current3","Boolean","listenerParams","listeners","l","onDragStart","tagName","preventDefault","postGestureClick","closest","createScopedElement","ref"],"sources":["C:\\Users\\zpili\\Desktop\\Finbox-VK-mini-apps\\mini-app\\node_modules\\@vkontakte\\vkui\\src\\components\\Touch\\Touch.tsx"],"sourcesContent":["import * as React from \"react\";\nimport {\n  getSupportedEvents,\n  coordX,\n  coordY,\n  touchEnabled,\n  VKUITouchEvent,\n} from \"../../lib/touch\";\nimport { HasComponent, HasRootRef } from \"../../types\";\nimport { useDOM } from \"../../lib/dom\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { useEventListener } from \"../../hooks/useEventListener\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\n\nexport interface TouchProps\n  extends React.AllHTMLAttributes<HTMLElement>,\n    HasRootRef<HTMLElement>,\n    HasComponent {\n  /**\n   * Привязать onEnter и onLeave через pointer-events - работает на disabled-инпутах\n   */\n  usePointerHover?: boolean;\n  useCapture?: boolean;\n  slideThreshold?: number;\n  noSlideClick?: boolean;\n  onEnter?: HoverHandler;\n  onLeave?: HoverHandler;\n  onStart?: TouchEventHandler;\n  onStartX?: TouchEventHandler;\n  onStartY?: TouchEventHandler;\n  onMove?: TouchEventHandler;\n  onMoveX?: TouchEventHandler;\n  onMoveY?: TouchEventHandler;\n  onEnd?: TouchEventHandler;\n  onEndX?: TouchEventHandler;\n  onEndY?: TouchEventHandler;\n  stopPropagation?: boolean;\n}\n\nexport interface Gesture {\n  startX: number;\n  startY: number;\n  startT: Date;\n  duration: number;\n  isPressed: boolean;\n  isY: boolean;\n  isX: boolean;\n  isSlideX: boolean;\n  isSlideY: boolean;\n  isSlide: boolean;\n  shiftX: number;\n  shiftY: number;\n  shiftXAbs: number;\n  shiftYAbs: number;\n}\n\nexport interface TouchEvent extends Gesture {\n  originalEvent: VKUITouchEvent;\n}\n\ntype HoverHandler = (outputEvent: MouseEvent) => void;\nexport type TouchEventHandler = (e: TouchEvent) => void;\nexport type ClickHandler = (e: React.MouseEvent<HTMLElement>) => void;\nexport type DragHandler = (e: React.DragEvent<HTMLElement>) => void;\n\nexport const Touch: React.FC<TouchProps> = ({\n  onStart,\n  onStartX,\n  onStartY,\n  onMove: _onMove,\n  onMoveX,\n  onMoveY,\n  onLeave,\n  onEnter,\n  onEnd: _onEnd,\n  onEndX,\n  onEndY,\n  onClickCapture,\n  usePointerHover,\n  slideThreshold = 5,\n  useCapture = false,\n  Component = \"div\",\n  getRootRef,\n  noSlideClick = false,\n  stopPropagation = false,\n  ...restProps\n}: TouchProps) => {\n  const { document } = useDOM();\n  const events = React.useMemo(getSupportedEvents, []);\n  const didSlide = React.useRef(false);\n  const gesture = React.useRef<Partial<Gesture> | null>(null);\n  const handle = (\n    e: VKUITouchEvent,\n    handers: Array<TouchEventHandler | undefined | false>\n  ) => {\n    stopPropagation && e.stopPropagation();\n    handers.forEach((cb) => {\n      const duration = Date.now() - (gesture.current?.startT?.getTime() ?? 0);\n      cb && cb({ ...(gesture.current as Gesture), duration, originalEvent: e });\n    });\n  };\n\n  const enterHandler = useEventListener(\n    usePointerHover ? \"pointerenter\" : \"mouseenter\",\n    onEnter\n  );\n  const leaveHandler = useEventListener(\n    usePointerHover ? \"pointerleave\" : \"mouseleave\",\n    onLeave\n  );\n  const startHandler = useEventListener(\n    events[0],\n    (e: VKUITouchEvent) => {\n      gesture.current = initGesture(coordX(e), coordY(e));\n\n      handle(e, [onStart, onStartX, onStartY]);\n      // 1 line, 2 bad specs, 2 workarounds:\n      subscribe(\n        touchEnabled()\n          ? // Touch events fire on initial target, and won't bubble if its removed\n            // see: #235, #1968, https://stackoverflow.com/a/45760014\n            (e.target as HTMLElement)\n          : // Mouse events fire on the element under pointer, so we lose move / end\n            // if pointer goes outside container.\n            // Can be fixed by PointerEvents' setPointerCapture later\n            document\n      );\n    },\n    { capture: useCapture, passive: false }\n  );\n  const containerRef = useExternRef(getRootRef);\n\n  useIsomorphicLayoutEffect(() => {\n    const el = containerRef.current;\n    if (el) {\n      enterHandler.add(el);\n      leaveHandler.add(el);\n      startHandler.add(el);\n    }\n  }, [Component]);\n\n  function onMove(e: VKUITouchEvent) {\n    const {\n      isPressed,\n      isX,\n      isY,\n      startX = 0,\n      startY = 0,\n    } = gesture.current ?? {};\n\n    if (isPressed) {\n      // смещения\n      const shiftX = coordX(e) - startX;\n      const shiftY = coordY(e) - startY;\n\n      // абсолютные значения смещений\n      const shiftXAbs = Math.abs(shiftX);\n      const shiftYAbs = Math.abs(shiftY);\n\n      // Если определяем мультитач, то прерываем жест\n      if (!!e.touches && e.touches.length > 1) {\n        return onEnd(e);\n      }\n\n      // если мы ещё не определились\n      if (!isX && !isY) {\n        const willBeX = shiftXAbs >= slideThreshold && shiftXAbs > shiftYAbs;\n        const willBeY = shiftYAbs >= slideThreshold && shiftYAbs > shiftXAbs;\n        const willBeSlidedX = willBeX && (!!onMoveX || !!_onMove);\n        const willBeSlidedY = willBeY && (!!onMoveY || !!_onMove);\n\n        Object.assign(gesture.current, {\n          isY: willBeY,\n          isX: willBeX,\n          isSlideX: willBeSlidedX,\n          isSlideY: willBeSlidedY,\n          isSlide: willBeSlidedX || willBeSlidedY,\n        });\n      }\n\n      if (gesture.current?.isSlide) {\n        Object.assign(gesture.current, {\n          shiftX,\n          shiftY,\n          shiftXAbs,\n          shiftYAbs,\n        });\n\n        handle(e, [\n          _onMove,\n          gesture.current.isSlideX && onMoveX,\n          gesture.current.isSlideY && onMoveY,\n        ]);\n      }\n    }\n  }\n\n  function onEnd(e: VKUITouchEvent) {\n    const { isPressed, isSlide, isSlideX, isSlideY } = gesture.current ?? {};\n\n    if (isPressed) {\n      handle(e, [_onEnd, isSlideY && onEndY, isSlideX && onEndX]);\n    }\n\n    didSlide.current = Boolean(isSlide);\n    gesture.current = {};\n\n    // Если это был тач-евент, симулируем отмену hover\n    if (touchEnabled()) {\n      onLeave && onLeave(e);\n    }\n    subscribe(null);\n  }\n\n  const listenerParams = { capture: useCapture, passive: false };\n  const listeners = [\n    useEventListener(events[1], onMove, listenerParams),\n    useEventListener(events[2], onEnd, listenerParams),\n    useEventListener(events[3], onEnd, listenerParams),\n  ];\n  function subscribe(el: HTMLElement | Document | null | undefined) {\n    if (el) {\n      listeners.forEach((l) => l.add(el));\n    }\n  }\n\n  /**\n   * Обработчик событий dragstart\n   * Отменяет нативное браузерное поведение для вложенных ссылок и изображений\n   */\n  const onDragStart = (e: React.DragEvent<HTMLElement>) => {\n    const target = e.target as HTMLElement;\n    if (target.tagName === \"A\" || target.tagName === \"IMG\") {\n      e.preventDefault();\n    }\n  };\n\n  /**\n   * Обработчик клика по компоненту\n   * Отменяет переход по вложенной ссылке, если был зафиксирован свайп\n   */\n  const postGestureClick: typeof onClickCapture = (e) => {\n    if (!didSlide.current) {\n      return onClickCapture && onClickCapture(e);\n    }\n    // eslint-disable-next-line no-restricted-properties\n    if ((e.target as HTMLElement).closest(\"a\")) {\n      e.preventDefault();\n    }\n    if (noSlideClick) {\n      e.stopPropagation();\n    } else {\n      onClickCapture && onClickCapture(e);\n    }\n    didSlide.current = false;\n  };\n\n  return (\n    <Component\n      {...restProps}\n      onDragStart={onDragStart}\n      onClickCapture={postGestureClick}\n      ref={containerRef}\n    />\n  );\n};\n\nfunction initGesture(startX: number, startY: number): Gesture {\n  return {\n    startX,\n    startY,\n    startT: new Date(),\n    duration: 0,\n    isPressed: true,\n    isY: false,\n    isX: false,\n    isSlideX: false,\n    isSlideY: false,\n    isSlide: false,\n    shiftX: 0,\n    shiftY: 0,\n    shiftXAbs: 0,\n    shiftYAbs: 0,\n  };\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}